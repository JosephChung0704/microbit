<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>micro:bit BLE Test</title>
</head>
<body>
  <h2>micro:bit Bluetooth ì—°ê²° í…ŒìŠ¤íŠ¸</h2>

  <button onclick="connectMicrobit()">ğŸ”— micro:bit ì—°ê²°</button>
  <button onclick="sendMessage('mask_on')">ğŸ˜· ë§ˆìŠ¤í¬ ì°©ìš©</button>
  <button onclick="sendMessage('mask_off')">ğŸ™…â€â™‚ï¸ ë¯¸ì°©ìš©</button>

  <div id="log"></div>

  <script>
    let bluetoothDevice;
    let txCharacteristic;

    function log(msg) {
      console.log(msg);
      document.getElementById("log").innerHTML += msg + "<br>";
    }

    async function connectMicrobit() {
      try {
        bluetoothDevice = await navigator.bluetooth.requestDevice({
          acceptAllDevices: true,
          optionalServices: ["6e400001-b5a3-f393-e0a9-e50e24dcca9e"] // Nordic UART Service
        });

        const server = await bluetoothDevice.gatt.connect();
        const service = await server.getPrimaryService("6e400001-b5a3-f393-e0a9-e50e24dcca9e");
        txCharacteristic = await service.getCharacteristic("6e400002-b5a3-f393-e0a9-e50e24dcca9e");

        log("âœ… micro:bit ì—°ê²° ì„±ê³µ: " + bluetoothDevice.name);
      } catch (error) {
        log("âŒ ì—°ê²° ì‹¤íŒ¨: " + error);
      }
    }

    async function sendMessage(message) {
      if (!txCharacteristic) {
        log("âš ï¸ micro:bitê°€ ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
        return;
      }
      const encoder = new TextEncoder();
      await txCharacteristic.writeValue(encoder.encode(message));
      log("ğŸ“¨ ë©”ì‹œì§€ ì „ì†¡: " + message);
    }
  </script>
</body>
</html>
